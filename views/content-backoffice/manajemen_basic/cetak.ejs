<!--  BACKUP ASLI SERVER BENAR -->

<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="#" type="image/png">

    <title></title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <link href="/resources-maps/stylesheets/leaflet-routing-machine.css" rel="stylesheet"/>
    <link href="/resources-maps/stylesheets/L.Control.Locate.min.css" rel="stylesheet"/>
    <link href="/resources-maps/stylesheets/leaflet-routing-machine.css" rel="stylesheet"/>
    <link href="/resources-maps/stylesheets/leaflet.extra-markers.css" rel="stylesheet"/>
    <link href="/resources-maps/stylesheets/leaflet.label.css" rel="stylesheet"/>
    <link href="/resources-maps/stylesheets/groupedlayercontrol.css" rel="stylesheet"/>
    <link href="/resources-maps/stylesheets/leaflet.draw.css" rel="stylesheet"/>
    <link href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" rel="stylesheet"> 
    <link href="/resources-maps/stylesheets/Control.FullScreen.css" rel="stylesheet"/>


    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet-src.js"></script>
    <script src="https://unpkg.com/esri-leaflet@2.1.1/dist/esri-leaflet.js"
       integrity="sha512-ECQqaYZke9cSdqlFG08zSkudgrdF6I1d8ViSa7I3VIszJyVqw4ng1G8sehEXlumdMnFYfzY0tMgdQa4WCs9IUw=="
       crossorigin=""></script>
       <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
       <script src="/resources-maps/javascripts/leaflet-routing-machine.js"></script>
       <script src="/resources-maps/javascripts/leaflet.label.js"></script>
       <script src="/resources-maps/panah-asmara.js"></script>
       <script src="https://maps.google.com/maps/api/js?v=3.2&key=AIzaSyBy8irzccEOp7ezf5nQ2UPaLGcte_AEsOQ"></script>
       <script src='https://unpkg.com/leaflet.gridlayer.googlemutant@latest/Leaflet.GoogleMutant.js'></script>
       <script src="/resources-maps/javascripts/L.Control.Locate.js" ></script>
       <script src="/resources-maps/javascripts/leaflet-routing-machine.js"></script>
       <script src="/resources-maps/javascripts/leaflet.extra-markers.js"></script>
       <script src="/resources-maps/javascripts/leaflet-image.js"></script>
       <script src="https://d3js.org/topojson.v1.min.js"></script>
       <script src="/resources-maps/javascripts/Control.FullScreen.js"></script>
       <script src="/resources-maps/javascripts/groupedlayercontrol.js"></script>
       <script src="/resources-maps/javascripts/wicket.js"></script>
       <script src="/resources-maps/javascripts/wicket-leaflet.js"></script>
       <script src="/resources-maps/javascripts/leaflet-omnivore.min.js"></script>
       <script src="/resources-maps/draw/Leaflet.draw.js"></script>
       <script src="/resources-maps/draw/Leaflet.Draw.Event.js"></script>
       <script src="/resources-maps/draw/Toolbar.js"></script>
       <script src="/resources-maps/draw/Tooltip.js"></script>
       <script src="/resources-maps/draw/ext/GeometryUtil.js"></script>
       <script src="/resources-maps/draw/ext/LatLngUtil.js"></script>
       <script src="/resources-maps/draw/ext/LineUtil.Intersect.js"></script>
       <script src="/resources-maps/draw/ext/Polygon.Intersect.js"></script>
       <script src="/resources-maps/draw/ext/Polyline.Intersect.js"></script>
       <script src="/resources-maps/draw/ext/TouchEvents.js"></script>
       <script src="/resources-maps/draw/draw/DrawToolbar.js"></script>
       <script src="/resources-maps/draw/draw/handler/Draw.Feature.js"></script>
       <script src="/resources-maps/draw/draw/handler/Draw.SimpleShape.js"></script>
       <script src="/resources-maps/draw/draw/handler/Draw.Polyline.js"></script>
       <script src="/resources-maps/draw/draw/handler/Draw.Marker.js"></script>
       <script src="/resources-maps/draw/draw/handler/Draw.Polygon.js"></script>
       <script src="/resources-maps/draw/draw/handler/Draw.Rectangle.js"></script>
       <script src="/resources-maps/draw/edit/EditToolbar.js"></script>
       <script src="/resources-maps/draw/edit/handler/EditToolbar.Edit.js"></script>
       <script src="/resources-maps/draw/edit/handler/EditToolbar.Delete.js"></script>
       <script src="/resources-maps/draw/Control.Draw.js"></script>
       <script src="/resources-maps/draw/edit/handler/Edit.Poly.js"></script>
       <script src="/resources-maps/draw/edit/handler/Edit.SimpleShape.js"></script>
       <script src="/resources-maps/draw/edit/handler/Edit.Rectangle.js"></script>
       <script src="/resources-maps/draw/edit/handler/Edit.Marker.js"></script> 
       <script src="/resources-maps/main.js"></script>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style type="text/css">
        body {
            background: rgb(204,204,204); 
            font-size:12pt;
            line-height:1.5em;
            font-family: 'Roboto', sans-serif !important;
        }

        page {
            background: white;
            display: block;
            margin: 0 auto;
            margin-bottom: 5mm;
            box-shadow: 0 0 5mm rgba(0,0,0,0.5);
            /*border:2px solid black;*/
        }

        page[size="A4"] {
            width: 310mm;
            height: 208mm;  
            /* border:1px solid black; */
            /*background-color: red;*/
            /* float: left; */
        }

        @page {
            size: A4 landscape;
            margin:15mm 15mm;
            background-color: red;
        }
        
        span{
            color:red !important;
        }
        @media print {
            body, page {
            margin: 0;
            box-shadow: none;
            }

            #btn-print{
            display: none !important;
            }
        }

        .m-t-0{
            margin-top: 0;
        }

        .m-b-0{
            margin-bottom: 0;
        }

        /* table { page-break-inside:auto } */
        /* tr    { page-break-inside:avoid; page-break-after:auto} */
        .border {border: 0.5mm solid black !important}


        h4{
            margin-top: 0px;
            margin-bottom: 0px;
            font-weight: normal;
        }

        span{
            color: red;
        }

        .button {
            background-color: red;
            border: none;
            color: white;
            padding: 15px 25px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 6px;
            position: absolute;
            top: 0;
            right: 0;
        }

        .button:hover{
            background-color: #fff;
            color: black;
        }
      /* div{
        page-break-inside: avoid;
      } */
      /*table { page-break-inside:auto }*/
      /*tr    { page-break-inside:avoid; page-break-after:auto }
      thead { display:table-header-group }
      tfoot { page-break-inside:avoid; page-break-after:auto  }*/
    </style>
</head>

<body style="position: relative;">
    <button class="button"  id="btn-print">Cetak</button>
    <page size="A4">
        <div style="width: 100%;height: 30mm;background-color: ;display: flex;align-items:  center;">
          <img src="/images/template/logo kota salatiga.png" alt="" style="height: 30mm;">
          <h2 style="margin-top: 0;margin-bottom: 0;margin-left: 5mm;">
            DINAS PERTANIAN KOTA SALATIGA<br/>Jalan Menur No. 27, Kota Salatiga
          </h2>
        </div>
        <div style="display: flex;margin-top: 10mm;">
            <div style="width: 60%;height: 158mm;background-color: ;">
                <div style="width: 100%;height: 158mm;" id="map"></div>
            </div>
            <div style="width: 40%;height: 158mm;background-color: ;">
                <div style="padding: 2.5mm;">
                    <table border="0" cellpadding="5" cellspacing="0" style="width: 100%;border-collapse: collapse;">
                        <tbody>
                            <tr>
                                <td style="width: 50mm;">No. Bidang</td>
                                <td style="width: 1mm;">:</td>
                                <td><%= data[0].no_bidang%></td>
                            </tr>

                            <tr>
                                <td>Alamat</td>
                                <td>:</td>
                                <td><%= data[0].alamat%></td>
                            </tr>

                            <tr>
                                <td>Kecamatan</td>
                                <td>:</td>
                                <td><%= data[0].kec%></td>
                            </tr>

                            <tr>
                                <td>Kelurahan</td>
                                <td>:</td>
                                <td><%= data[0].kel%></td>
                            </tr>

                            <tr>
                                <td>Pemilik</td>
                                <td>:</td>
                                <td><%= data[0].pemilik%></td>
                            </tr>

                            <tr>
                                <td>Penggarap</td>
                                <td>:</td>
                                <td><%= data[0].penggarap%></td>
                            </tr>

                            <!-- <tr>
                                <td>Koordinat Lokasi</td>
                                <td>:</td>
                                <td><%= data[0].kel%></td>
                            </tr> -->

                            <tr>
                                <td>Jenis Lahan</td>
                                <td>:</td>
                                <td><%= data[0].jenis_lahan%></td>
                            </tr>

                            <tr>
                                <td>Status Lahan</td>
                                <td>:</td>
                                <td><%= data[0].status_lahan%></td>
                            </tr>

                            <tr>
                                <td>Luas</td>
                                <td>:</td>
                                <td><%= data[0].luas%></td>
                            </tr>

                            <!-- <tr>
                                <td>Pemanfaatan Lahan</td>
                                <td>:</td>
                                <td><%= data[0].kel%></td>
                            </tr> -->
                        </tbody>
                    </table>
                </div>

                <div style="padding: 2.5mm;">
                    <img src="/foto/<%= data[0].sumber_lp2b%>" alt="Foto Tidak Ada" style="width: 100%;height: 70mm;">
                </div>
            </div>
        </div>
        
    </page>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script type="text/javascript">
    $('#btn-print').click(function(){
         window.print();
    });

    function toWKT (layer) {
              var lng, lat, coords = [];
             if (layer instanceof L.Polygon || layer instanceof L.Polyline) {
               var latlngs = layer.getLatLngs();
             for (var i = 0; i < latlngs.length; i++) {
                 var latlngs1 = latlngs[i];
                 if (latlngs1.length){
                 for (var j = 0; j < latlngs1.length; j++) {
                   coords.push(latlngs1[j].lng + " " + latlngs1[j].lat);
                   if (j === 0) {
                     lng = latlngs1[j].lng;
                     lat = latlngs1[j].lat;
                   }
                 }}
                 else
                 {
                   coords.push(latlngs[i].lng + " " + latlngs[i].lat);
                   if (i === 0) {
                     lng = latlngs[i].lng;
                     lat = latlngs[i].lat;
                   }}
             };
               if (layer instanceof L.Polygon) {
                 return "POLYGON((" + coords.join(",") + "," + lng + " " + lat + "))";
               } else if (layer instanceof L.Polyline) {
                 return "LINESTRING(" + coords.join(",") + ")";
               }
             } else if (layer instanceof L.Marker) {
               return "POINT(" + layer.getLatLng().lng + " " + layer.getLatLng().lat + ")";
             }
           };
        $(document).ready(function() {
   
        
               $("#parsepeta").on("click", function () {
                drawnItems.clearLayers();
                inputan_koordinat ="";
                end_koordinat = "";
              var tableHtml=$('table.order-list')  // tableHtml is a jQuery of the table

              tableHtml.find('tbody > tr').each(function(){ 
                   
                                   if(inputan_koordinat==""){
                     end_koordinat= ''+$(this).find('input[name^="x"]').val() +' '+$(this).find('input[name^="y"]').val()
                    }
                                  inputan_koordinat = inputan_koordinat+''+$(this).find('input[name^="x"]').val() +' '+$(this).find('input[name^="y"]').val()+',';
              });
            inputan_koordinat = inputan_koordinat + end_koordinat;
              console.log(inputan_koordinat);
             layer_parse=   omnivore.wkt.parse('POLYGON(('+inputan_koordinat+'))');

             $('#wkt').val('POLYGON(('+inputan_koordinat+'))');
                   layer_parse.eachLayer(function (layer) {

                                      var bounds = layer.getBounds();
                                      map.fitBounds(bounds)
                        //         // Get center of bounds
                                 var center = bounds.getCenter();
                        

                       drawnItems.addLayer(layer);
                      })
              });
                     $("#reset_peta").on("click", function () {
                     drawnItems.clearLayers();
                      
                          
                                           $('#myTable tbody').html('<tr><td><input type="text" name="x[]" style="width:100%"/></td><td><input type="text" name="y[]" style="width:100%"/></td><td><a class="deleteRow" style="width:100%"></a></td> </tr>');
                                            $('#wkt').empty();
                     
                    });
                       $("#addrow").on("click", function () {

                   counter = $('#myTable tr').length - 2;

                   var newRow = $("<tr>");
                   var cols = "";

                   cols += '<td><input type="text" name="x[]" style="width:100%"/></td>';
                   cols += '<td><input type="text" name="y[]" style="width:100%"/></td>';

                   cols += '<td><input type="button" class="ibtnDel"  value="Hapus" style="width:100%"></td>';
                   newRow.append(cols);
                 //  if (counter == 4) $('#addrow').attr('disabled', true).prop('value', "You've reached the limit");
                   $("table.order-list").append(newRow);
                   counter++;
                   $("table.order-list").on("click", ".ibtnDel", function (event) {
                       $(this).closest("tr").remove();
                   
                       
                       counter -= 1
                       $('#addrow').attr('disabled', false).prop('value', "Tambah Koordinat");
                   });
                   //  var price = +row.find('input[name^="price"]').val();
               });
            
        });
     

         var warna_total = ['#ffffff','#ffffff'];
              var labels = ['',''];
               var wkt = new Wkt.Wkt();
          function onLocationFound(e) {
              var radius = e.accuracy / 2;
              
              if(center == 0 ){
                map.setView(e.latlng, 13);
                center++;
              }
             //   var koordinat = {latlng:{lat: ye, lng: xe}};
             
                
             //console.log(koordinat)
              clickHandler(e)
              // iht_layer.eachLayer(function (layer) {
              //   layer_lat_long = layer.getLatLng();
              //   layer_lat = layer.getLatLng().lat;
              //   layer_lng = layer.getLatLng().lng;

              //   // jarak ke point saat ini dalam meter
              //   var posisi_kita_lat = e.latlng.lat;
              //   var posisi_kita_lng = e.latlng.lng;

              //   jarak = layer_lat_long.distanceTo(e.latlng);

              //   var popupContent = getPopup( layer, posisi_kita_lat, posisi_kita_lng, layer_lat, layer_lng );
              //   layer.bindPopup(popupContent, popupOptions);
              //   if(jarak > 30000){
              //      // layer.setOpacity(0);
              //      // layer.unbindPopup();
              //   }
              // });
            }
          

            
            function ke_lokasi(x_awal, y_awal, x_akhir, y_akhir){
              map.closePopup();
              console.log(x_awal+ ' , ' +y_awal+ ' ; ' +x_akhir + ' , ' + y_akhir)

              if(navigasi!=null){
                navigasi.spliceWaypoints(navigasi.getWaypoints().length - 1, 1, L.latLng(x_akhir, y_akhir));   
              }
              else{
                navigasi =  L.Routing.control({
                  // waypointIcon :
                  // waypoints : [L.latLng(x_awal, y_awal), L.latLng(x_akhir, y_akhir)]
                  plan: L.Routing.plan([
                      L.latLng(x_awal, y_awal),
                      L.latLng(x_akhir, y_akhir)
                  ], 
                  {
                    createMarker: function(i, wp) {
                      return L.marker(wp.latLng, {
                        draggable: false,
                        icon: routeIcon
                      });
                    }
                    // geocoder: L.Control.Geocoder.nominatim(),
                    // routeWhileDragging: true
                  })
                });
                navigasi.addTo(map);
                console.log(navigasi.getPlan());
                $('.leaflet-routing-container').append('<a href="#" id="tutup_navigasi" onclick="tutup_navigasi()">BATAL</a>');
              }
            }
            
            function tutup_navigasi() {
              if(navigasi!=null){
                navigasi.spliceWaypoints(0, 2);
                $('.leaflet-routing-container').hide();
                navigasi = null;
              }
            }

            function tambah_titik(x, y, id_jalan){

              map.panTo(new L.LatLng(x, y));
              map.setZoom(16);

              jalan_layer.eachLayer(function (layer) {
                if ( layer.feature.properties.id_jalan == id_jalan ) {
                  console.log(layer.feature.properties)
                  layer.openPopup();
                };
              });
            }

            $('#cari').click(function(){
              var xe =  $('#xe').val();
              var ye = $('#ye').val();
            
              map.setView( new L.LatLng(ye, xe), 16)
             
             
                 peta_pemohon("POINT("+xe+" "+ye+")")
             //console.log(koordinat)
             // clickHandler(koordinat)
                return false 
            })


            /**
             * 
             *  Variables Initialization
             * 
             */
            var kabupaten_layer;
            var iht_layer = null;
            var source = null;
            var marker;
            var lingkaran;
            var center = 0;
            var navigasi=null;
            var kabupaten_layer;
            var marker_search='';

            /**
             * 
             *  Layer Styling
             * 
             */
            var sembunyi = {
              color : "transparent",
              weight : 1,
              opacity : 0,
              fillOpacity : 0
            };
            
             var style_kabupaten = {
                  color : "yellow", 
                  weight : 3, 
                  opacity : 1, 
                  fillOpacity  : 0,
                  dashArray : 3
                };
             var style_gambar = {
                  color : "blue", 
                  weight : 2, 
                  opacity : 1, 
                  fillOpacity  : 0
                  
                };
                 var style_desa = {
                  color : "white", 
                  weight : 1, 
                  opacity : 1, 
                  fillOpacity  : 0,
                  dashArray : 3
                };
             var style_polaruang = {
              color : "cyan", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.3,
              dashArray : 3
            };
             var style_perikanan = {
              color : "#C1EFFD", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };
             var style_hutan_lindung = {
              color : "#DFFFEA", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };
             var style_pertahanan = {
              color : "#F224C6", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };
             var style_hutan_produksi_terbatas = {
              color : "#B2E8E8", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };

            var style_hutan_produksi_tetap = {
              color : "#99F2CD", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };

            

            var style_kawasan_industri = {
              color : "#E4E8B3", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };

            var style_permukiman = {
              color : "#FCDB2B", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };

            var style_pertanian_lahan_basah = {
              color : "#CBFFB5", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };

            var style_pertanian_lahan_kering = {
              color : "#95FEBD", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };

            var style_rth = {
              color : "#97FEC0", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };

            var style_sempadan_pantai = {
              color : "#CCFFCC", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };

            var style_sempadan_sungai = {
              color : "#C1FFCD", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };

            var style_kawasan_tanaman_pangan = {
              color : "#98f442", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  :0.7,
              dashArray : 3
            };

            var style_lppb = {
              color : "#2ECC71", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  :0.7,
              dashArray : 3
            };

          

            var style_kabupaten_gelap = {
              color : "#000", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0,
              dashArray : 3
            };
            
            var popupOptions = {
              maxWidth : '450',
              minWidth : '250',
              className : 'custom',
              closeOnClick : true
            };

            /**
             * 
             *  Map initialization
             * 
            . The Longitude of Kota Pati is 
             */
            var southWest = L.latLng(-8.629903118263488, 108.0780029296875),
              northEast = L.latLng(-6.124169589851178, 112.52746582031249),
              bounds = L.latLngBounds(southWest, northEast);
            var map = L.map('map', {
                center: [ -7.33194, 110.49278],
                // maxBounds: bounds,
                zoom: 11,
                minZoom:2,
                maxZoom:19,
                fullscreenControl: true,
                fullscreenControlOptions: {
                  position: 'topleft'
                }
            });


            //ngilangi garis putih
    



              function clickHandler(e) {
             
   //  var clickBounds = L.latLngBounds(e.latlng, e.latlng);

   //  var intersectingFeatures = [];
   //    for (var l in map._layers) {
   //    var overlay = map._layers[l];
   //    if (overlay._layers) {
   //      for (var f in overlay._layers) {
   //        var feature = overlay._layers[f];
   //        var bounds;
   //        if (feature.getBounds) bounds = feature.getBounds();
   //        else if (feature._latlng) {
   //          bounds = L.latLngBounds(feature._latlng, feature._latlng);
   //        }
   //        if (bounds && clickBounds.intersects(bounds)) {
   //          intersectingFeatures.push(feature);
   //        }
   //      }
   //    }
   //  }
   // intersectingFeatures.map(function(o) {
   //    console.log(o)
   //  })
   //  var html = "Found features: " + intersectingFeatures.length + "<br/>" + intersectingFeatures.map(function(o) {
   //    return o.feature
   //  }).join('<br/>');
   $('#xe').val(e.latlng.lng) 
   $('#ye').val(e.latlng.lat) 
  var html ="";
   
    html = html + "</br></br>Pola Ruang RTRW : </br>"
   $.ajax({
            type : "GET",
            async : false,
            global : false,
            url : root + "peta/list_polaruang?x="+e.latlng.lng+"&y="+e.latlng.lat,
            dataType : 'json',
            success: function (data) {
           // console.log(data)
           $.each(data, function(){
                html = html + this.rencana_tg+"</br>";
            })
              
            }
          });

   html = html + "</br>Koordinat : </br>"
    html = html + "</br>"+e.latlng.lng+" "+e.latlng.lat+"</br>"

    
       
    map.openPopup(html, e.latlng);
  }




            // map.fitBounds(bounds);

            var google_roadmap    = L.gridLayer.googleMutant({
                                                            type: 'roadmap',
                                                            styles: [
                                                                        {elementType: 'geometry', stylers: [{color: '#242f3e'}]},
                                                                        {elementType: 'labels.text.stroke', stylers: [{color: '#242f3e'}]},
                                                                        {elementType: 'labels.text.fill', stylers: [{color: '#746855'}]},
                                                                        {
                                                                          featureType: 'administrative.locality',
                                                                          elementType: 'labels.text.fill',
                                                                          stylers: [{color: '#d59563'}]
                                                                        },
                                                                        {
                                                                          featureType: 'poi',
                                                                          elementType: 'labels.text.fill',
                                                                          stylers: [{color: '#d59563'}]
                                                                        },
                                                                        {
                                                                          featureType: 'poi.park',
                                                                          elementType: 'geometry',
                                                                          stylers: [{color: '#263c3f'}]
                                                                        },
                                                                        {
                                                                          featureType: 'poi.park',
                                                                          elementType: 'labels.text.fill',
                                                                          stylers: [{color: '#6b9a76'}]
                                                                        },
                                                                        {
                                                                          featureType: 'road',
                                                                          elementType: 'geometry',
                                                                          stylers: [{color: '#38414e'}]
                                                                        },
                                                                        {
                                                                          featureType: 'road',
                                                                          elementType: 'geometry.stroke',
                                                                          stylers: [{color: '#212a37'}]
                                                                        },
                                                                        {
                                                                          featureType: 'road',
                                                                          elementType: 'labels.text.fill',
                                                                          stylers: [{color: '#9ca5b3'}]
                                                                        },
                                                                        {
                                                                          featureType: 'road.highway',
                                                                          elementType: 'geometry',
                                                                          stylers: [{color: '#746855'}]
                                                                        },
                                                                        {
                                                                          featureType: 'road.highway',
                                                                          elementType: 'geometry.stroke',
                                                                          stylers: [{color: '#1f2835'}]
                                                                        },
                                                                        {
                                                                          featureType: 'road.highway',
                                                                          elementType: 'labels.text.fill',
                                                                          stylers: [{color: '#f3d19c'}]
                                                                        },
                                                                        {
                                                                          featureType: 'transit',
                                                                          elementType: 'geometry',
                                                                          stylers: [{color: '#2f3948'}]
                                                                        },
                                                                        {
                                                                          featureType: 'transit.station',
                                                                          elementType: 'labels.text.fill',
                                                                          stylers: [{color: '#d59563'}]
                                                                        },
                                                                        {
                                                                          featureType: 'water',
                                                                          elementType: 'geometry',
                                                                          stylers: [{color: '#17263c'}]
                                                                        },
                                                                        {
                                                                          featureType: 'water',
                                                                          elementType: 'labels.text.fill',
                                                                          stylers: [{color: '#515c6d'}]
                                                                        },
                                                                        {
                                                                          featureType: 'water',
                                                                          elementType: 'labels.text.stroke',
                                                                          stylers: [{color: '#17263c'}]
                                                                        }
                                                                      ]
                                                       // valid values are 'roadmap', 'satellite', 'terrain' and 'hybrid'
                                                        })

            var google_hybrid     = L.gridLayer.googleMutant({
                                                            type: 'hybrid' // valid values are 'roadmap', 'satellite', 'terrain' and 'hybrid'
                                                        })
            var google_satelit    = L.gridLayer.googleMutant({
                                                            type: 'satellite' // valid values are 'roadmap', 'satellite', 'terrain' and 'hybrid'
                                                        })
            var osm               = L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {});
            var Esri_WorldImagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');
           // var RBI            = L.tileLayer('http://portal.ina-sdi.or.id/arcgis/rest/services/IGD/RupabumiIndonesia/MapServer');

            var RBI =  L.esri.tiledMapLayer({
              url: "https://portal.ina-sdi.or.id/arcgis/rest/services/IGD/RupabumiIndonesia/MapServer"
            });
                           (function(){
                var originalInitTile = L.GridLayer.prototype._initTile
                L.GridLayer.include({
                    _initTile: function (tile) {
                        originalInitTile.call(this, tile);

                        var tileSize = this.getTileSize();

                        tile.style.width = tileSize.x + 1 + 'px';
                        tile.style.height = tileSize.y + 1 + 'px';
                    }
                });
            })()
            map.addLayer(google_hybrid);

            var legend = L.control({position: 'bottomleft'});
            var streetview = L.control({position: 'bottomright'});
            
            //gambar
            var drawnItems = L.featureGroup().addTo(map);
            var options = {
                  position: 'topleft',
                  draw: {
                      polyline: false,
                      polygon: true,
                      circle: false, // Turns off this drawing tool
                      rectangle: false,
                      marker: false
                  },
                  edit: {
                      featureGroup: drawnItems, //REQUIRED!!
                      remove: true
                  }
              };
              
              var drawControl = new L.Control.Draw(options);
              map.addControl(drawControl);
              
               map.on(L.Draw.Event.CREATED, function(event) {
                 drawnItems.clearLayers();
                  var layer = event.layer;
                //  $('#wkt').val(toWKT(layer))
                  drawnItems.addLayer(layer);
                   peta_pemohon(toWKT(layer))
                //   $("#xe").val(layer.getLatLng().lng)
                // $("#ye").val(layer.getLatLng().lat)
                });

               map.on(L.Draw.Event.EDITED, function(event) {
                 drawnItems.clearLayers();
                  var layers = event.layers;
                     $("#xe").val(layers.getLatLng().lng)
                $("#ye").val(layers.getLatLng().lat)
                   // layers.eachLayer(function (layer) {
                         //do whatever you want; most likely save back to db
                        //  console.log(layer)     
                    //       peta_pemohon(toWKT(layer))
                     //});
               
                });
            //gambar end 



            var locateIcon = L.ExtraMarkers.icon({
                icon: 'fa-map-marker', 
                markerColor: 'blue-dark', 
                prefix: 'fa',
                iconColor: 'white',
                shape: 'square'
            });

            var ihtIconAktif = L.ExtraMarkers.icon({
                prefix: 'fa', 
                markerColor: 'green-light', 
                icon: 'fa-building', 
                iconColor: 'white',
                shape: 'square'
            });

            var ihtIconTidakAktif = L.ExtraMarkers.icon({
                prefix: 'fa', 
                markerColor: 'red', 
                icon: 'fa-ban', 
                iconColor: 'white',
                shape: 'square'
            });

            var ihtIconTidakDiketahui = L.ExtraMarkers.icon({
                prefix: 'fa', 
                markerColor: 'orange', 
                icon: 'fa-question', 
                iconColor: 'white',
                shape: 'square'
            });

            var routeIcon = L.ExtraMarkers.icon({
                prefix: 'fa', 
                markerColor: 'red', 
                icon: 'fa-location-arrow', 
                iconColor: 'white',
                shape: 'square'
            });

            // $.getJSON( root + "index.php/kabupaten", function( json ) {
            //   $.each(json, function( i, item ) {
            //     $('#kabupaten').append('<option value="'+item.id_kabupaten+'">'+item.nama_kabupaten+'</option>');
            //   })
            // });
          //ambil ksp  
          var label_kec = [];
          var label_desa = [];
      var popup = new L.popup();
         
                  //topojson
                  L.TopoJSON = L.GeoJSON.extend({  
                    addData: function(jsonData) {    
                      if (jsonData.type === "Topology") {
                        for (key in jsonData.objects) {
                          geojson = topojson.feature(jsonData, jsonData.objects[key]);
                          L.GeoJSON.prototype.addData.call(this, geojson);
                        }
                      }    
                      else {
                        L.GeoJSON.prototype.addData.call(this, jsonData);
                      }
                    }  
                  });
                  //topojson
            var wellmaxzoom = 13;       
          var polaruang_layer = new L.GeoJSON();
          var kabupaten_layer = new L.TopoJSON();
          var desa_layer = new L.TopoJSON();
              var bendung = new L.TopoJSON();
      
          var penunjang = new L.TopoJSON();
          var permasalahan = new L.TopoJSON();
          var pintu_air = new L.TopoJSON();
          var sadap = new L.TopoJSON();
          var sawah = new L.TopoJSON();
          var saluran = new L.TopoJSON();
          var jalan_layer = new L.TopoJSON();
         
         
          
          //hapus labeh
          function hapus_label_kec(){
             var ii = 0;
                  kabupaten_layer.eachLayer(function (layer) {
                map.removeLayer(label_kec[ii]);
                // label[ii].clearLayers();
                 ii++;
              })
                  label_kec = [];
          }
          function tampil_label_kec(){
             var ii = 0;
                      kabupaten_layer.eachLayer(function (layer) {
                        label_kec[ii].setOpacity(1);
                    // label[ii].clearLayers();
                     ii++;
                  })
          }
          function hide_label_kec(){
             var ii = 0;
                      kabupaten_layer.eachLayer(function (layer) {
                        label_kec[ii].setOpacity(0);
                    // label[ii].clearLayers();
                     ii++;
                  })
          }

          function hapus_label_desa(){
             var ii = 0;
                  desa_layer.eachLayer(function (layer) {
                   if(label_desa[ii]){
                    // map.removeLayer(label_desa[ii]);
                       label_desa[ii].setOpacity(0);
                   }
                
                // label[ii].clearLayers();
                 ii++;
              })
                 // label_desa = [];
          }
          function tampil_label_desa(){
             var ii = 0;
                      desa_layer.eachLayer(function (layer) {
                        label_desa[ii].setOpacity(1);
                    // label[ii].clearLayers();
                     ii++;
                  })
          }
          function hide_label_desa(){
             var ii = 0;
                      desa_layer.eachLayer(function (layer) {
                        label_desa[ii].setOpacity(0);
                    // label[ii].clearLayers();
                     ii++;
                  })
          }
          function loadGeoJsonkec(data) {
            hapus_label_kec();
            kabupaten_layer.clearLayers();
            kabupaten_layer.addData(data);

            kabupaten_layer.addTo(map);
            var i = 0;
            var labelnya = "";
             kabupaten_layer.eachLayer(function (layer) {

                  
                    layer.setStyle(style_kabupaten);
                    // layer.bindPopup(feature.properties.kabupaten);
                    // Get bounds of polygon
                    var bounds = layer.getBounds();
                    // Get center of bounds
                    var center = bounds.getCenter();
                    //center.on('click', alert('asu'));
                    // Use center to put marker on map
                    //var marker = L.marker(center).addTo(map);
                    //labelnya
                     label_kec[i] = new L.Tooltip({
                    noHide: false,
                    direction: 'auto',
                    permanent : true
                    });
                      labelnya = layer.feature.properties.kecamatan;
                     
                  label_kec[i].setContent(labelnya);
                  label_kec[i].setLatLng(center);
                 // label_kec[i].setOpacity(0);
                  map.showLabel(label_kec[i]);
                   layer.on('click', function (e) {
                                   //  panorama(e.latlng.lat, e.latlng.lng);
                                     // clickHandler(e)
                                      });
                  i++;
                    // layer.on("click", function (e) {
                    //       // var bounds = layer.getBounds();
                    //       // var popupContent = "popup content here";
                    //       // popup.setLatLng(bounds.getCenter());
                    //       // popup.setContent(popupContent);
                    //       // map.openPopup(popup);
                    //    //  $('#bs-example-modal-lg').modal('show');
                    //   });
             });
          }
          function loadGeoJsondesa(data) {

            hapus_label_desa();
            desa_layer.clearLayers();
            desa_layer.addData(data);
            desa_layer.addTo(map);
            var i = 0;
            var labelnya = "";
             desa_layer.eachLayer(function (layer) {

                  
                       layer.setStyle(style_desa);

                    // layer.bindPopup(feature.properties.kabupaten);
                    // Get bounds of polygonid_kel
                    var bounds = layer.getBounds();
                    // Get center of bounds
                    var center = bounds.getCenter();
                    //center.on('click', alert('asu'));
                    // Use center to put marker on map
                    //var marker = L.marker(center).addTo(map);
                    //labelnya
                     label_desa[i] = new L.Tooltip({
                    noHide: false,
                    direction: 'auto',
                    permanent : true
                    });
                      labelnya = layer.feature.properties.desa;
                     
                  label_desa[i].setContent(labelnya);
                  label_desa[i].setLatLng(center);
                  label_desa[i].setOpacity(0);
                  map.showLabel(label_desa[i]);
                   layer.on('click', function (e) {
                     // drawnItems.clearLayers();
                     // $('#konten_polaruang').empty()
                     //              $.ajax({
                     //                       type : "GET",
                     //                       async : false,
                     //                       global : false,
                     //                       url : root + "peta/list_polaruang_desa/"+layer.feature.properties.kode_d,
                     //                       dataType : 'json',
                     //                       success: function (data) {
                     //                     // console.log(data)
                     //                              var latlngss = layer.getLatLngs();
                     //                      // console.log(latlngss[0])
                     //                           var seeArea =  L.GeometryUtil.geodesicArea(latlngss[0]);
                     //                               seeArea = L.GeometryUtil.readableArea(seeArea, true, {})
                     //                     $('#tabel_kecamatan_desa').empty()
                     //                        $.each(data.admin, function(){

                     //                          $('#tabel_kecamatan_desa').append("<tr><td>"+this.kecamatan+"</td><td>"+this.desa+" ("+seeArea+")</td></tr>")
                     //                        })
                                           
                     //                      var i = 0;
                     //                        $('#tabel_polaruang').empty()
                     //                      $.each(data.pola_ruang, function(){
                     //                          var total = 0;
                     //                              $.each(this.irisan, function(){
                     //                                      if(this.polygon){

                     //                                       wkt.read(''+this.polygon+'');
                     //                                        var latlngss = wkt.toObject().getLatLngs();
                     //                                           var gambar = wkt.toObject();
                     //                                          gambar.setStyle(style_gambar);
                     //                                           drawnItems.addLayer(gambar);
                     //                                       //  console.log(this)
                     //                                       //  console.log(wkt.toObject().getLatLngs())
                     //                                           //hitung luas
                     //                                         if(wkt.toObject().getLatLngs().length > 1){
                     //                                           $.each(latlngss, function(index, value){
                     //                                            if(value.length > 1){
                     //                                              $.each(value, function(indexx, valuee){
                     //                                                var luas =  L.GeometryUtil.geodesicArea(valuee);
                     //                                                total = total + luas; 
                     //                                              })
                     //                                            }else{
                     //                                              var luas =  L.GeometryUtil.geodesicArea(value);
                     //                                                total = total + luas;  
                     //                                            }
                                                                  
                                                                  
                     //                                           })
                     //                                         }else{

                     //                                          var luas =  L.GeometryUtil.geodesicArea(latlngss[0]);
                                                              
                     //                                                total = total + luas;   
                     //                                         }
                     //                                      }
                                                                
                                                                         
                     //                              })
                     //                              if(total != 0){
                     //                                 total = L.GeometryUtil.readableArea(total, true, {})
                     //                               }else{
                     //                                total = "Kesalahan dalam Penghitungan!"
                     //                               }
                     //                               i = i + 1;
                     //                               // html = html + "<tr><td>Kategori Pola Ruang</td><td>:</td><td>"+this.rencana_tg+" ("+total+")</td></tr>"
                                                  
                     //                                $('#tabel_polaruang').append("<tr><td>"+i+"</td><td>"+this.rencana_tg+"  ("+total+")</td><td>"+this.pemanfaata+"</td><td>"+this.pengendali+"</td></tr>")

                     //                              // html = html + this.rencana_tg+" ("+total+")</br>";
                     //                       })
                     //                          $("#link_print").html('  <a class="btn btn-success visible-md visible-lg" href="/pola_ruang/cetak/'+layer.feature.properties.kode_d+'" role="button">Cetak Peta</a>')
                     //                         // $("#konten-detail").toggle("slide", {direction:"right"}, 500);
                     //                         $('.modal').modal('show');
                     //                       }
                     //                     });
                                      });
                  i++;
                    // layer.on("click", function (e) {
                    //       // var bounds = layer.getBounds();
                    //       // var popupContent = "popup content here";
                    //       // popup.setLatLng(bounds.getCenter());
                    //       // popup.setContent(popupContent);
                    //       // map.openPopup(popup);
                    //     // $('#bs-example-modal-lg').modal('show');
                    //   });
             });
             hapus_label_desa();
             map.removeLayer(drawnItems);
                       drawnItems.addTo(map);
          }
         function loadGeoJsonjalan(data) {
          
            jalan_layer.clearLayers();
            jalan_layer.addData(data);
            jalan_layer.addTo(map);
       
            var i = 0;
            var labelnya = "";
            jalan_layer.eachLayer(function (layer) {

                  
                   // layer.setStyle(style_sempadan_sungai);
                   // layer.bindPopup(layer.feature.properties.rencana_tg);
                    // Get bounds of polygon
                   // var bounds = layer.getBounds();
                    // Get center of bounds
                   // var center = bounds.getCenter();
                    //center.on('click', alert('asu'));
                    // Use center to put marker on map
                    //var marker = L.marker(center).addTo(map);
                    //labelnya
                    var stl = {
              color : "red", 
              weight : 3, 
              opacity : 1, 
              fillOpacity  : 0
            };
            layer.setStyle(stl);
             
                  i++;
                    layer.on("click", function (e) {
                          var bounds = layer.getBounds();
                          var popupContent = "Posisi : "+layer.feature.properties.pos_jln;
                          popup.setLatLng(bounds.getCenter());
                          popup.setContent(popupContent);
                          map.openPopup(popup);
                       //  $('#bs-example-modal-lg').modal('show');
                      });
             });
             //    map.removeLayer(jalan_layer);
          }
        function loadGeoJsonsaluran(data) {
        
          saluran.clearLayers();
          saluran.addData(data);
          saluran.addTo(map);
        
          var i = 0;
          var labelnya = "";
          saluran.eachLayer(function (layer) {

            
                  var stl = {
            color : "cyan", 
            weight : 3, 
            opacity : 1, 
            fillOpacity  : 0
          };
          layer.setStyle(stl);
           
                i++;
                  layer.on("click", function (e) {
                        var bounds = layer.getBounds();
                        var popupContent = "Nama : "+layer.feature.properties.nm_sal;
                        popup.setLatLng(bounds.getCenter());
                        popup.setContent(popupContent);
                        map.openPopup(popup);
                     //  $('#bs-example-modal-lg').modal('show');
                    });
           });
           //    map.removeLayer(jalan_layer);
        }
          function loadGeoJsonpenunjang(data) {
          
            penunjang.clearLayers();
            penunjang.addData(data);
                  penunjang.addTo(map);
            var i = 0;
            var labelnya = "";
            penunjang.eachLayer(function (layer) {

                 // layer.setOpacity(1)
                    var icn = L.icon({
                      iconUrl: '/images/penunjang.png',
                    
                  });
               
                layer.setIcon(icn);
                  i++;
                    layer.on("click", function (e) {

                          var popupContent = "Jenis Bangunan : "+layer.feature.properties.jns_bgn;
                          popup.setLatLng(layer.getLatLng());
                          popup.setContent(popupContent);
                          map.openPopup(popup);
                       //  $('#bs-example-modal-lg').modal('show');
                      });
             });
              //   map.removeLayer(penunjang);
          }
          function loadGeoJsonbendung(data) {
          
            bendung.clearLayers();
            bendung.addData(data);
            bendung.addTo(map);
            var i = 0;
            var labelnya = "";
            bendung.eachLayer(function (layer) {
                var icn = L.icon({
                      iconUrl: '/images/bendung.png',
                    
                  });
               
                layer.setIcon(icn);
                  i++;
                   layer.on("click", function (e) {

                          var popupContent = "Nama : "+layer.feature.properties.nm_bendung;
                          popup.setLatLng(layer.getLatLng());
                          popup.setContent(popupContent);
                          map.openPopup(popup);
                       //  $('#bs-example-modal-lg').modal('show');
                      });
             });
               //  map.removeLayer(bendung);
          }
          function loadGeoJsonpermasalahan(data) {
          
            permasalahan.clearLayers();
            permasalahan.addData(data);
             permasalahan.addTo(map);
            var i = 0;
            var labelnya = "";
            permasalahan.eachLayer(function (layer) {

                        var icn = L.icon({
                      iconUrl: '/images/permasalahan.png',
                    
                  });
               
                layer.setIcon(icn);
                  i++;
                   layer.on("click", function (e) {

                          var popupContent = "Permasalahan : "+layer.feature.properties.masalah;
                          popup.setLatLng(layer.getLatLng());
                          popup.setContent(popupContent);
                          map.openPopup(popup);
                       //  $('#bs-example-modal-lg').modal('show');
                      });
             });
               //  map.removeLayer(permasalahan);
          }
           function loadGeoJsonpintu_air(data) {
          
            pintu_air.clearLayers();
            pintu_air.addData(data);
            pintu_air.addTo(map);
            var i = 0;
            var labelnya = "";
            pintu_air.eachLayer(function (layer) {

              var icn = L.icon({
                      iconUrl: '/images/pintuair.png',
                    
                  });
               
                layer.setIcon(icn);
                  layer.on("click", function (e) {

                          var popupContent = "Nomenklatur : "+layer.feature.properties.nomenklatr;
                          popup.setLatLng(layer.getLatLng());
                          popup.setContent(popupContent);
                          map.openPopup(popup);
                       //  $('#bs-example-modal-lg').modal('show');
                      });
                  i++;
                 
             });
               //  map.removeLayer(pintu_air);
          }
           function loadGeoJsonsadap(data) {
          
            sadap.clearLayers();
            sadap.addData(data);
            sadap.addTo(map);
            var i = 0;
            var labelnya = "";
            sadap.eachLayer(function (layer) {
                    var icn = L.icon({
                      iconUrl: '/images/sadap.png',
                    
                  });
               
                layer.setIcon(icn);
          
                  i++;
                       layer.on("click", function (e) {

                          var popupContent = "Nomenklatur : "+layer.feature.properties.nomenklatr;
                          popup.setLatLng(layer.getLatLng());
                          popup.setContent(popupContent);
                          map.openPopup(popup);
                       //  $('#bs-example-modal-lg').modal('show');
                      });
             });
                // map.removeLayer(sadap);
          }
           function loadGeoJsonsawah(data) {
          
            sawah.clearLayers();
            sawah.addData(data);
            sawah.addTo(map);
            var i = 0;
            var labelnya = "";
            sawah.eachLayer(function (layer) {
                        var stl = {
                  color : "green", 
                  weight : 3, 
                  opacity : 1, 
                  fillOpacity  : 0.7
                };
                layer.setStyle(stl);
               layer.on("click", function (e) {

                          var popupContent = "Nama Pemilik : "+layer.feature.properties.nama;
                          popup.setLatLng(layer.getLatLng());
                          popup.setContent(popupContent);
                          map.openPopup(popup);
                       //  $('#bs-example-modal-lg').modal('show');
                      });
                  i++;
                
             });
              //   map.removeLayer(sawah);
          }

        

        

   




        


     


  // do stuff after marker has been added

    
  function doAnimations(){
     var myIcon = document.querySelector('.gps_ring')
    //sesudah
     myIcon.style.width = '1000px'
     
  }

          
             
               
                   

          //ambil kec
            var geoJsonUrl =root+"peta/topojson_kec"; 
              $.getJSON(geoJsonUrl)
                .done(loadGeoJsonkec);
                //ambil polaruang
                

               
                 //ambil eksisting
           
                map.on('moveend', function(){
                 if(map.getZoom() > 10 && map.getZoom() < 14){
                       tampil_label_kec();
                 }else{
                  hide_label_kec();
                 }
               })
                  var kiri_atas_lng  = map.getBounds().getSouthWest().lng;
            var kiri_atas_lat  = map.getBounds().getSouthWest().lat;
            var kanan_bawah_lng = map.getBounds().getNorthEast().lng;
            var kanan_bawah_lat = map.getBounds().getNorthEast().lat;
               
                    
                   
                //end ambil_kec

          //saat pindah
        //  map.on('moveend', function(){
          // if(map.getZoom() > wellmaxzoom){
            //kembali ke asal

           
           //kembali ke asal

            var kiri_atas_lng  = map.getBounds().getSouthWest().lng;
            var kiri_atas_lat  = map.getBounds().getSouthWest().lat;
            var kanan_bawah_lng = map.getBounds().getNorthEast().lng;
            var kanan_bawah_lat = map.getBounds().getNorthEast().lat;
           //   var geoJsonUrl =root + "index.php/peta/geo_kec_bound/"+kiri_atas_lng+"/"+kiri_atas_lat+"/"+kanan_bawah_lng+"/"+kanan_bawah_lat; 
              var geoJsonUrl =root+"peta/topojson_desa?kiri_lng="+kiri_atas_lng+"&kiri_lat="+kiri_atas_lat+"&kanan_lng="+kanan_bawah_lng+"&kanan_lat="+kanan_bawah_lat; 
             // console.log(geoJsonUrl);
            // console.log(map.getBounds().toBBoxString());
            // console.log(map.getBounds().getSouthWest().lng + ';' + map.getBounds().getSouthWest().lat + ';' + map.getBounds().getNorthEast().lng + ';' + map.getBounds().getNorthEast().lat);
          //    var boundingBox = L.rectangle(map.getBounds(), {color: "#ff7800", weight: 1});
          // map.addLayer(boundingBox);
              // $.ajax({
              //     url: geoJsonUrl,
              //     datatype: 'json',
              //     jsonCallback: 'getJson',
              //     success: loadGeoJson
              //     });
              $.getJSON(geoJsonUrl)
                .done(loadGeoJsondesa);

                      $("#id_kel").change(function() {
                       desa_layer.eachLayer(function (layer) {
                     //   console.log(layer.feature.properties.id_kelurahan == );
                        var bounds = layer.getBounds();
                        // Get center of bounds
                       // var center = bounds.getCenter();
                      if(layer.feature.properties.id_kelurahan == $("#id_kel").val()){
                                 map.fitBounds(bounds);
                      }
               
                       })
                     })

                
              // }else{
              // hapus_label_desa();
              //   map.removeLayer(desa_layer);
              // };
        //  });
            map.on('moveend', function(){
                    if(map.getZoom() > wellmaxzoom){
                      tampil_label_desa();
                            }else{
                            hapus_label_desa();
                           //   map.removeLayer(desa_layer);
                            };
                       });
          //end moveend

     legend.onAdd = function (map) {
              var div = L.DomUtil.create('div', 'info-legend')
             
             // loop through our density intervals and generate a label with a colored square for each interval
              for (var i = 0; i < warna_total.length; i++) {
                div.innerHTML += '<i style="background:' + warna_total[i] + '"></i> ' + labels[i] + '<br>';
              }
              return div;
            };

           legend.addTo(map);

            var baseLayers = {
              "Google Roadmap": google_roadmap,
              "Google Hybrid": google_hybrid,
              "Google Satellite": google_satelit,
              "Open Street Map": osm,
              "ESRI World Imagery": Esri_WorldImagery,
              "RBI": RBI
            };
            
            // var overlays = {
            //   "kecamatan": kabupaten_layer,
            //   "<span>RTRW Semapadan Sungai</span>&nbsp;&nbsp;<span style='background-color:#499277;padding:2px 8px 2px 8px;'></span>": sempadan_sungai,
            //   "<span>RTRW Sempadan Pantai</span>&nbsp;&nbsp;<span style='background-color:#3F786F;padding:2px 8px 2px 8px;'></span>": sempadan_pantai,
            //   "<span>RTRW Kawasan Konservasi/KA</span>&nbsp;&nbsp;<span style='background-color:#195344;padding:2px 8px 2px 8px;'></span>": kawasan_konservasi,
            //   "<span>RTRW Hutan Lindung</span>&nbsp;&nbsp;<span style='background-color:#8C8D88;padding:2px 8px 2px 8px;'></span>": hutan_lindung,
            //   "<span>RTRW Tambak</span>&nbsp;&nbsp;<span style='background-color:#48B3C5;padding:2px 8px 2px 8px;'></span>": tambak,
            //   "<span>RTRW Lahan Basah Kering</span>&nbsp;&nbsp;<span style='background-color:#C8DEB0;padding:2px 8px 2px 8px;'></span>": lahan_basah_kering,
            //   "<span>RTRW Permukiman Perkotaan</span>&nbsp;&nbsp;<span style='background-color:#E8B05D;padding:2px 8px 2px 8px;'></span>": permukiman_perkotaan,
            //   "<span>RTRW Permukiman Perdesaan</span>&nbsp;&nbsp;<span style='background-color:#E8B05D;padding:2px 8px 2px 8px;'></span>": permukiman_perdesaan,
            //   "<span>RTRW Perkebunan</span>&nbsp;&nbsp;<span style='background-color:#ABBC6E;padding:2px 8px 2px 8px;'></span>": perkebunan,
            //   "<span>RTRW Industri</span>&nbsp;&nbsp;<span style='background-color:#9E8986;padding:2px 8px 2px 8px;'></span>": industri,
            //   "<span>RTRW Hutan Produksi Terbatas</span>&nbsp;&nbsp;<span style='background-color:#7EA4D3;padding:2px 8px 2px 8px;'></span>": hutan_produksi_terbatas,
            //   "<span>RTRW Hutan Produksi</span>&nbsp;&nbsp;<span style='background-color:#7EA4D3;padding:2px 8px 2px 8px;'></span>": hutan_produksi,
            //   "<span>Jalan</span>&nbsp;&nbsp;<span style='background-color:red;padding:2px 8px 2px 8px;'></span>": jalan_layer
             
              
            // };
            
            // L.control.layers(baseLayers,overlays,{
            //   position : 'topright'
            // }, {'drawlayer':drawnItems}, { position: 'topleft', collapsed: false }).addTo(map);

                          var groupedOverlays = {
                                 "Administrasi": {
                   "&nbsp;&nbsp;&nbsp;&nbsp;kecamatan": kabupaten_layer,
                  "&nbsp;&nbsp;&nbsp;&nbsp;Kelurahan/Desa": desa_layer,
                  
                   },
                   "Layer": {
                   
                
                  // "&nbsp;&nbsp;&nbsp;&nbsp;<span>Saluran</span>&nbsp;&nbsp;<span style='background-color:cyan;padding:2px 8px 2px 8px;'></span>": saluran,
                  // "&nbsp;&nbsp;&nbsp;&nbsp;<span>Jalan Inspeksi</span>&nbsp;&nbsp;<span style='background-color:red;padding:2px 8px 2px 8px;'></span>": jalan_layer,
                  // "&nbsp;&nbsp;&nbsp;&nbsp;<span>Areal Sawah</span>&nbsp;&nbsp;<span style='background-color:green;padding:2px 8px 2px 8px;'></span>": sawah,
                  // "&nbsp;&nbsp;&nbsp;&nbsp;<span>Bendung</span>&nbsp;&nbsp;": bendung,
                  // "&nbsp;&nbsp;&nbsp;&nbsp;<span>Pintu Air</span>&nbsp;&nbsp;": pintu_air,
                  // "&nbsp;&nbsp;&nbsp;&nbsp;<span>Bangunan Sadap</span>&nbsp;&nbsp;": sadap,
                  // "&nbsp;&nbsp;&nbsp;&nbsp;<span>Bangunan Penunjang</span>&nbsp;&nbsp;": penunjang,
                  // "&nbsp;&nbsp;&nbsp;&nbsp;<span>Permasalahan</span>&nbsp;&nbsp;": permasalahan
                   }
                 };
                       var options = {
         // Make the "Landmarks" group exclusive (use radio inputs)
        // exclusiveGroups: ["Landmarks"],
         // Show a checkbox next to non-exclusive group labels for toggling all
         collapsed:true,
         groupCheckboxes: false
       };
            L.control.groupedLayers(baseLayers, groupedOverlays, options).addTo(map);
         

            streetview.onAdd = function (map) {
              var div = L.DomUtil.create('div', 'sv')
             
             // loop through our density intervals and generate a label with a colored square for each interval
                div.innerHTML += '';
              
              return div;
            };

           // streetview.addTo(map);

            L.control.scale({
              position : 'bottomright',
              metric : true,
              imperial : false
            }).addTo(map);
            
            // lc = L.control.locate({
            //   position : 'topleft',
            //   follow : true,
            //   strings : {
            //     title : "Lokasi Anda",
            //     popup: "Anda berada di radius {distance} {unit} dari titik ini"
            //   },
            //   markerClass : L.marker,
            //   markerStyle : {icon: locateIcon},
            //   keepCurrentZoomLevel : true
            // }).addTo(map);

            map
              .on('startfollowing', function() {
                map.on('dragstart', lc._stopFollowing, lc);
              })
              .on('stopfollowing', function() {
                  map.off('dragstart', lc._stopFollowing, lc);
              });

            map.on('locationfound', onLocationFound);
            

            // map.on('moveend', function() { 
            //      console.log(map.getBounds());
            // });

            map.on('baselayerchange', function(e) {
              console.log(e.name);

              if ( e.name == 'Google Roadmap' || e.name == 'Open Street Map' || e.name == 'Mapbox Street') {
                kabupaten_layer.eachLayer(function (layer) {
               //   layer.setStyle(style_kabupaten_gelap);
                });
              }else{
                kabupaten_layer.eachLayer(function (layer) {
                  layer.setStyle(style_kabupaten);
                });
              }

            });
            
            //ganti kabupaten
            $('#search_maps').hide();


           // $('.leaflet-bottom.leaflet-left').hide();
            
            $('.leaflet-bar-part.leaflet-bar-part-single').click(function () {
             
            })
            

            //panorama
           var marker= "";
           var titik_panorama = null;
            function panorama(xe,ye){
               if(titik_panorama != null){
              map.removeLayer(titik_panorama);     
               }
               if(marker!=""){
                 map.removeLayer(marker);
                 
               }
                  titik_panorama = L.marker([xe, ye]).addTo(map);
               var fenway = new google.maps.LatLng(xe,ye);
                 var panoramaOptions = {
                   position: fenway,
                   pov: {
                     heading: 34,
                     pitch: 10
                   }
                 };
                 var panorama = new  google.maps.StreetViewPanorama(document.getElementById('pano'),panoramaOptions);
               
          }

          peta_pemohon('<%= data[0].dataValues.wktt%>')
    </script>
</body>
</html>
